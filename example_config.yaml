esphome:
  name: test-fp2

  devices:
    - id: test_sofa_zone_device
      name: "Test Sofa Zone Device"

esp32:
  board: esp32-solo1
  framework:
    type: esp-idf

    sdkconfig_options:
      CONFIG_FREERTOS_UNICORE: "y"
      CONFIG_ESP_SYSTEM_SINGLE_CORE_MODE: "y"
    advanced:
      ignore_efuse_mac_crc: true
      ignore_efuse_custom_mac: true

# Configure `api` and `wifi`

logger:

uart:
  id: uart_bus
  tx_pin: GPIO19
  rx_pin: GPIO18
  baud_rate: 890000

external_components:
  - source:
      type: local
      path: components

aqara_fp2_accel:
  id: fp2_accel

aqara_fp2:
  id: fp2
  accel: fp2_accel

  uart_id: uart_bus

  # Radar Reset Pin (from README: IO13 - RAD U11 / NRESET)
  reset_pin: GPIO13
  mounting_position: left_corner
  left_right_reverse: false

  presence_sensitivity: medium
  closing_setting: 1
  fall_detection_sensitivity: low

  people_counting_report_enable: false
  people_number_enable: false
  target_type_enable: false

  target_tracking:
    name: "Targets"

  location_report_switch:
    name: "Report Targets"

  # 14x14 Grid (Active Area)
  interference_grid: |-
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .

  exit_grid: |-
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .
    . . . . . . . . . . . . . .

  zones:
    - id: sofa_zone
      sensitivity: high
      grid: |-
        . . X X X . . . . . . . . .
        . . X X X . . . . . . . . .
        . . X X X . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
        . . . . . . . . . . . . . .
      presence: sofa_zone_presence
      zone_map: sofa_zone_map

  edge_label_grid_sensor: edge_label_grid_sensor
  entry_exit_grid_sensor: entry_exit_grid_sensor
  interference_grid_sensor: interference_grid_sensor
  mounting_position_sensor: mounting_position_sensor

# User Button (README: SENSOR_VP - USER_SWITCH -> GPIO36)
binary_sensor:
  - platform: gpio
    pin: GPIO36
    name: "User Button"
    on_press:
      then:
        - logger.log: "Button Pressed!"

  - platform: template
    id: sofa_zone_presence
    name: "Sofa Zone Presence"
    device_class: occupancy
    device_id: test_sofa_zone_device

text_sensor:
  - platform: template
    id: mounting_position_sensor
    name: "Mounting Position"

  - platform: template
    id: edge_label_grid_sensor
    name: "Edge Label Grid"

  - platform: template
    id: entry_exit_grid_sensor
    name: "Entry Exit Grid"

  - platform: template
    id: interference_grid_sensor
    name: "Interference Grid"

  - platform: template
    id: sofa_zone_map
    name: "Zone Map"
    device_id: test_sofa_zone_device

# Status LED (README: IO27 - LED). Using one channel of RGB as status.
# Unused: IO26, IO14
light:
  - platform: status_led
    name: "Status LED"
    pin: GPIO27
